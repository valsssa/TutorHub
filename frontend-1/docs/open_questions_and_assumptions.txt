
# Open Questions & Assumptions

This document tracks the working assumptions made during the frontend prototyping phase and lists critical questions that must be resolved with the backend team before production implementation.

## 1. Frontend Assumptions (What we mocked)

### **A. Data Structures**
*   **IDs:** The frontend assumes all IDs (`userId`, `tutorId`, `sessionId`) are unique strings. We are agnostic to the format (UUID vs Integer) but treat them as opaque strings.
*   **Currency:** Monetary values (`hourlyRate`, `balance`) are currently treated as JavaScript `number` types (floats).
    *   *Assumption:* The backend will handle safe math and potentially send values as integers (cents) or formatted strings to avoid floating-point errors.
*   **Dates:** All date/time fields are assumed to be **ISO 8601 UTC strings** (e.g., `2023-10-27T10:00:00Z`).
    *   *Assumption:* The frontend is responsible for converting these to the user's local timezone for display.

### **B. Feature Logic**
*   **Search:** The `MarketplacePage` currently performs client-side filtering on a loaded array of tutors.
    *   *Assumption:* The backend will support equivalent query parameters (e.g., `?min_price=10&max_price=50&subject=Math`) to offload this processing.
*   **Availability:** The frontend manages availability as a simple array of ISO date strings representing specific slots.
    *   *Assumption:* The backend might use a more complex structure (Recurrence Rules / RRules) for weekly schedules. The frontend expects the API to "flatten" these into specific available slots for a requested date range.
*   **Booking:** We assume a booking is "confirmed" immediately upon button click (Optimistic UI).
    *   *Assumption:* The backend handles the race condition (two students booking the same slot) and returns a 409 Conflict if necessary.

---

## 2. Questions for Backend Team

### **A. Authentication & Security**
1.  **Token Storage:** Will we use HttpOnly Cookies for the Refresh Token (preferred for security) or rely entirely on Headers?
2.  **Session Timeout:** What is the configured lifetime of the Access Token? (Frontend assumes ~15 mins).
3.  **Role Switching:** How do we handle users who are both Students and Tutors? Do they have one User ID with two roles, or distinct profiles?

### **B. Third-Party Integrations**
1.  **Video Provider:** Which vendor (Daily.co, Agora, Twilio) are we using?
    *   *Requirement:* We need an endpoint `POST /sessions/:id/token` that returns a room token for the frontend SDK.
2.  **Payments:** Are we using Stripe Connect?
    *   *Requirement:* How does the frontend initiate the "Onboarding" flow for Tutors to receive payouts?
3.  **AI Key:** Should the Gemini API calls remain on the client (using a proxy for the key) or be moved entirely to a backend endpoint (`POST /api/smart-search`)?

### **C. API Contracts**
1.  **Pagination:** Do you prefer Cursor-based (better for infinite scroll) or Offset-based (easier for page numbers) pagination for the Tutor list?
2.  **Error Messages:** Can we guarantee the error format defined in `error_handling_contract.txt`? Specifically the `details` object for form validation mapping.

---

## 3. Known Risks

### **A. Performance**
*   **Large Lists:** The current implementation of `MarketplacePage` filters data locally. If the tutor count exceeds ~500, this will cause performance issues. **Mitigation:** Backend search implementation is critical for launch.
*   **Chat History:** Loading full chat history on mount is inefficient. **Mitigation:** Need pagination/infinite scroll for message logs.

### **B. Data Integrity**
*   **Timezones:** If the backend stores dates in anything other than UTC, or if the server's local time leaks into responses, users will see incorrect lesson times.
*   **Currency Math:** Performing calculations like `balance - price` on the client side is risky. This logic **must** move to the backend to ensure ledger integrity.

### **C. Race Conditions**
*   **Booking:** Since there is no "hold" mechanism implemented in the UI, a user might spend 5 minutes on the payment screen while someone else books the slot.
    *   *Proposed Fix:* Backend should implement a temporary reservation (e.g., 10 mins) when the user enters the Payment flow.
